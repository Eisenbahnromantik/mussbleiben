<!-- Sichtbarer Zähler nur für den Button -->
<p class="small">E-Mail öffnen geklickt: <span id="mailClicks">–</span></p>

<script>
  // ----- Deine bestehende Mail-Konfiguration -----
  const cfg = {
    to: "kai.gniffke@swr.de",
    subject: "Erhalt der Sendung Eisenbahn-Romantik",
    body:
      "Sehr geehrter Herr Prof. Dr. Gniffke,\n\n" +
      "mit großem Bedauern habe ich erfahren, dass die Sendung Eisenbahn-Romantik eingestellt wird. " +
      "Diese Nachricht hat mich – wie viele andere Zuschauerinnen und Zuschauer – sehr traurig gemacht.\n\n" +
      "Eisenbahn-Romantik ist ein einzigartiges und wertvolles Format, das Geschichte, Technik und Kultur " +
      "auf besondere Weise verbindet. Eine Absetzung dieser traditionsreichen Sendung wäre ein erheblicher Verlust " +
      "– nicht nur für mich persönlich, sondern für viele Menschen, die den Wert dieser Kultursendung schätzen.\n\n" +
      "Ich bitte Sie herzlich, sich für den Fortbestand von Eisenbahn-Romantik einzusetzen, und freue mich über " +
      "eine persönliche Rückmeldung von Ihnen.\n\n" +
      "Viele Grüße\n" +
      "ein Eisenbahn-Romantik Fan"
  };
  const mailto = `mailto:${cfg.to}?subject=${encodeURIComponent(cfg.subject)}&body=${encodeURIComponent(cfg.body)}`;

  const sendLink = document.getElementById('sendLink');
  sendLink.setAttribute('href', mailto);

  // ===== CountAPI-Setup =====
  const NS  = 'eisenbahnromantik';
  const KEY = 'mussbleiben_mailto';

  // Initialen Wert per JSONP laden (kompatibel, kein CORS nötig)
  function showMailClicks(data){
    const v = (data && typeof data.value === 'number') ? data.value : 0;
    document.getElementById('mailClicks').textContent = String(v);
  }
  (function initGet(){
    const s = document.createElement('script');
    s.src = `https://api.countapi.xyz/get/${encodeURIComponent(NS)}/${encodeURIComponent(KEY)}?callback=showMailClicks&_=${Date.now()}`;
    document.body.appendChild(s);
  })();

  // Beim Klick: zuerst zählen, DANN mailto öffnen
  function applyNewCount(data){
    if (data && typeof data.value === 'number') {
      document.getElementById('mailClicks').textContent = String(data.value);
    }
  }
  sendLink.addEventListener('click', function (e) {
    e.preventDefault();            // <- verhindert sofortige Navigation
    // Zähl-Request (JSONP), der sicher zurückkommt
    const s = document.createElement('script');
    s.src = `https://api.countapi.xyz/hit/${encodeURIComponent(NS)}/${encodeURIComponent(KEY)}?callback=applyNewCount&_=${Date.now()}`;
    document.body.appendChild(s);

    // nach kurzer Pause Mail-App öffnen (Zeit für den Zähl-Request)
    setTimeout(() => {
      try { window.location.href = mailto; } catch(_) {}
    }, 250);
  });

  // Dein Kopieren-Button kann unverändert bleiben
  const copyBtn = document.getElementById('copyBtn');
  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(cfg.body);
      copyBtn.textContent = 'Text kopiert ✔';
      setTimeout(() => copyBtn.textContent = 'Text in Zwischenablage', 1600);
    } catch(e) {
      alert('Kopieren nicht erlaubt – bitte manuell markieren und kopieren.');
    }
  });
</script>
